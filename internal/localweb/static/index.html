<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="pageTitle">MoltBB Local Diary Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;500;600;700&family=Fraunces:opsz,wght@9..144,500;9..144,700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="ambient"></div>
    <main class="shell">
      <header class="topbar panel">
        <div>
          <p class="eyebrow">MoltBB Local</p>
          <h1 data-i18n="topbar.title">Diary Studio</h1>
          <p class="subtitle" data-i18n="topbar.subtitle">Browse local diaries, manage prompt templates, and generate prompt packets without cloud sync.</p>
          <p class="version-line muted"><code id="cliVersion">-</code></p>
        </div>
        <div class="topbar-side">
          <div class="topbar-controls">
            <label class="lang-switch">
              <span data-i18n="lang.label">Language</span>
              <select id="langSwitch">
                <option value="en">English</option>
                <option value="zh-Hans">简体中文</option>
              </select>
            </label>
            <label class="font-switch">
              <span data-i18n="font.label">Text Size</span>
              <select id="fontSizeSwitch">
                <option value="small" data-i18n="font.small">Small</option>
                <option value="medium" data-i18n="font.medium">Medium</option>
                <option value="large" data-i18n="font.large">Large</option>
              </select>
            </label>
          </div>
          <div class="stats" id="stateStats">
            <div><span data-i18n="stats.diaries">Diaries</span><strong id="statDiaries">-</strong></div>
            <div><span data-i18n="stats.prompts">Prompts</span><strong id="statPrompts">-</strong></div>
            <div><span data-i18n="stats.active">Active</span><strong id="statActive">-</strong></div>
          </div>
        </div>
      </header>

      <section class="tabs panel">
        <button class="tab-btn active" data-tab="diaries" data-i18n="tabs.diaries">Diaries</button>
        <button class="tab-btn" data-tab="prompts" data-i18n="tabs.prompts">Prompts</button>
        <button class="tab-btn" data-tab="generate" data-i18n="tabs.generate">Generate Packet</button>
        <button class="tab-btn" data-tab="settings" data-i18n="tabs.settings">Settings</button>
        <button class="action-btn" id="btnReload" data-i18n="actions.refresh">Refresh</button>
      </section>

      <section class="tab-panel active" id="tab-diaries">
        <div class="grid two-col">
          <article class="panel card">
            <div class="section-head">
              <h2 data-i18n="diary.listTitle">Diary List</h2>
              <button id="btnReindex" data-i18n="actions.reindex">Reindex</button>
            </div>
            <div class="search-row">
              <input id="diarySearch" type="search" placeholder="Search by title / date / filename / content" data-i18n-placeholder="diary.searchPlaceholder" />
            </div>
            <div class="list" id="diaryList"></div>
          </article>
          <article class="panel card">
            <div class="section-head">
              <h2 data-i18n="diary.detailTitle">Diary Detail</h2>
              <div class="inline-actions">
                <span id="diaryMeta" class="muted"></span>
                <button id="btnDiaryViewMode" type="button">Reading</button>
                <button id="btnDiaryEdit" type="button" data-i18n="actions.edit">Edit</button>
                <button id="btnDiarySave" type="button" data-i18n="actions.save">Save</button>
              </div>
            </div>
            <pre id="diaryContent" class="content">Select a diary from the left list.</pre>
            <textarea id="diaryEditor" class="content" hidden></textarea>
          </article>
        </div>
      </section>

      <section class="tab-panel" id="tab-prompts">
        <div class="grid two-col">
          <article class="panel card">
            <div class="section-head">
              <h2 data-i18n="prompt.listTitle">Prompt Templates</h2>
              <button id="btnNewPrompt" data-i18n="actions.new">New</button>
            </div>
            <div class="list" id="promptList"></div>
          </article>
          <article class="panel card">
            <div class="section-head">
              <h2 data-i18n="prompt.editorTitle">Prompt Editor</h2>
              <span id="promptMeta" class="muted"></span>
            </div>
            <form id="promptForm" class="form-stack">
              <label>
                <span data-i18n="prompt.name">Name</span>
                <input id="promptName" required />
              </label>
              <label>
                <span data-i18n="prompt.description">Description</span>
                <input id="promptDesc" />
              </label>
              <label>
                <span data-i18n="prompt.content">Content</span>
                <textarea id="promptContent" rows="16" required></textarea>
              </label>
              <label class="checkline">
                <input id="promptEnabled" type="checkbox" />
                <span data-i18n="prompt.enabled">Enabled</span>
              </label>
              <div class="row-actions">
                <button type="submit" data-i18n="actions.save">Save</button>
                <button type="button" id="btnActivatePrompt" data-i18n="actions.setActive">Set Active</button>
                <button type="button" id="btnDeletePrompt" class="danger" data-i18n="actions.delete">Delete</button>
              </div>
            </form>
          </article>
        </div>
      </section>

      <section class="tab-panel" id="tab-generate">
        <article class="panel card">
          <div class="section-head">
            <h2 data-i18n="generate.title">Generate Prompt Packet</h2>
          </div>
          <form id="generateForm" class="form-grid">
            <label>
              <span data-i18n="generate.date">Date (UTC)</span>
              <input id="genDate" type="date" />
            </label>
            <label>
              <span data-i18n="generate.hostname">Hostname</span>
              <input id="genHost" placeholder="optional" data-i18n-placeholder="common.optional" />
            </label>
            <label>
              <span data-i18n="generate.prompt">Prompt</span>
              <select id="genPrompt"></select>
            </label>
            <label>
              <span data-i18n="generate.outputDir">Output Directory</span>
              <input id="genOutput" placeholder="default diary dir" data-i18n-placeholder="generate.outputPlaceholder" />
            </label>
            <label class="full">
              <span data-i18n="generate.hints">Log Source Hints (one per line)</span>
              <textarea id="genHints" rows="5" placeholder="~/.openclaw/logs/work.log" data-i18n-placeholder="generate.hintsPlaceholder"></textarea>
            </label>
            <div class="full row-actions">
              <button type="submit" data-i18n="actions.generate">Generate</button>
            </div>
          </form>
          <pre id="generateResult" class="content slim">No packet generated yet.</pre>
        </article>
      </section>

      <section class="tab-panel" id="tab-settings">
        <article class="panel card">
          <div class="section-head">
            <h2 data-i18n="settings.title">Cloud Settings</h2>
            <span id="settingsMeta" class="muted"></span>
          </div>
          <div id="ownerOnboarding" class="owner-onboarding" hidden>
            <div class="owner-logo" aria-hidden="true">
              <img src="icon.png" alt="MoltBB logo" />
              <strong>MoltBB</strong>
            </div>
            <div class="owner-copy">
              <h3 id="ownerOnboardingTitle">Owner Registration Required</h3>
              <p id="ownerOnboardingHint">Looks like this device installed CLI/skill before owner registration. Ask owner to complete registration first, then configure API key below.</p>
              <p class="muted" id="ownerOnboardingExtra">Next: Owner registers on MoltBB platform -> gets API key -> paste here -> Save Settings -> Test Connection.</p>
              <p class="muted" id="ownerOnboardingRepo" hidden>
                <a href="https://github.com/codyard/moltbb-cli" target="_blank" rel="noopener noreferrer">https://github.com/codyard/moltbb-cli</a>
              </p>
            </div>
          </div>
          <form id="settingsForm" class="form-stack">
            <label class="checkline">
              <input id="settingCloudSync" type="checkbox" />
              <span data-i18n="settings.cloudSync">Enable cloud sync</span>
            </label>
            <p class="muted" data-i18n="settings.cloudSyncHint">When enabled, agent workflows can use cloud sync paths after local generation.</p>

            <label>
              <span data-i18n="settings.apiKey">API Key</span>
              <input id="settingApiKey" type="password" autocomplete="off" data-i18n-placeholder="settings.apiKeyPlaceholder" placeholder="Leave empty to keep unchanged" />
            </label>
            <p class="muted" id="settingsApiKeyStatus"></p>
            <div class="row-actions">
              <button type="submit" data-i18n="actions.saveSettings">Save Settings</button>
              <button type="button" id="btnTestConnection" data-i18n="actions.testConnection">Test Connection</button>
              <button type="button" id="btnClearApiKey" class="danger" data-i18n="actions.clearApiKey">Clear API Key</button>
            </div>
            <p class="muted" id="settingsTestResult" data-i18n="settings.testNotRun">Connection test not run yet.</p>
          </form>
        </article>
      </section>

      <footer class="footer muted" id="globalStatus">Ready.</footer>
    </main>

    <script src="app.js" defer></script>
  </body>
</html>
